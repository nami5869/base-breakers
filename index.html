<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BASE BREAKER ‚Äî Pay to Play</title>
<style>
  :root{--bg:#070a12;--fg:#eaf4ff;--brand:#6366f1;--muted:#9fb0c3;--panel:#0b1220;--ok:#9be28a;--err:#ff7b7b}

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:radial-gradient(1200px 600px at 50% -10%,#121a2d 0,#070a12 60%);
    color:var(--fg);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    text-align:center; overflow:hidden;
  }
  a{color:#66ccff;text-decoration:none}
  .wrap{min-height:100%;display:flex;flex-direction:column}

  /* ===== Dashboard ===== */
  #dashboard{
    position:fixed; inset:0;
    display:flex; align-items:center; justify-content:center;
    background:radial-gradient(1000px 600px at 50% -10%, #121a2d 0, #070a12 70%);
    z-index:50;
  }
  .dash-card{
    background:var(--panel);
    border-radius:20px;
    padding:24px 30px;
    width:min(92vw, 420px);
    box-shadow:0 0 28px rgba(99,102,241,0.18);
    text-align:center;
  }
  .dash-title{color:#fff;font-size:2rem;margin:0 0 12px;display:flex;align-items:center;gap:12px;justify-content:center}
  .dash-title::before{content:"";width:16px;height:16px;border-radius:50%;background:#4f46e5;display:inline-block}
  .dash-user{opacity:.95;margin-bottom:14px}
  .dash-stats{display:flex;justify-content:center;gap:14px;margin:12px 0 18px}
  .dash-stat{
    background:rgba(99,102,241,.08);
    border:1px solid rgba(99,102,241,.35);
    border-radius:12px;
    padding:10px 16px; min-width:92px;
  }
  .dash-stat .v{color:var(--brand);font-weight:800;font-size:1.2rem}
  .dash-stat .k{color:var(--muted);font-size:.8rem}
  .dash-buttons{display:flex;justify-content:center;gap:10px}
  .btn{background:var(--brand);color:#111;border:none;border-radius:14px;padding:14px 24px;font-weight:800;cursor:pointer}
  .btn[disabled]{opacity:.6;cursor:not-allowed}

  /* Intro */
  #intro{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;padding:24px}
  h1{font-size:clamp(2rem,6vw,3rem);margin:0;color:#fff;letter-spacing:.5px}
  .lead{max-width:560px;color:var(--muted)}
  .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}

  /* HUD */
  #hud{display:none;gap:12px;align-items:center;justify-content:center;padding:10px}
  .chip{background:rgba(99,102,241,.08);border:1px solid rgba(99,102,241,.35);color:var(--brand);border-radius:999px;padding:8px 12px;font-weight:700}

  /* Stage */
  #stage{display:none;width:100vw;margin:0;padding:0}
  .frame{position:relative;border:0;border-radius:0;background:transparent}
  canvas#game{display:block;width:100vw;height:calc(100vh - 120px);border-radius:0}

  /* Corner controls (two separate anchors) */
  .cornerControl {
    position: fixed;
    bottom: max(12px, env(safe-area-inset-bottom));
    z-index: 40;
    pointer-events: auto;
  }
  .cornerControl.left  { left:  max(12px, env(safe-area-inset-left)); }
  .cornerControl.right { right: max(12px, env(safe-area-inset-right)); }

  .fab-btn{
    width:56px; height:56px;
    border-radius:50%;
    border:none;
    background:#8b5cf6;
    color:#fff;
    font-size:22px;
    font-weight:900;
    box-shadow:0 8px 24px rgba(139,92,246,.35), inset 0 0 0 2px rgba(255,255,255,.12);
    cursor:pointer; user-select:none;
  }
  .fab-btn:active{transform:scale(0.98)}
  .fab-btn span{position:relative; top:-1px;}

  dialog{border:none;border-radius:16px;background:#0b1220;color:#fff;padding:22px;max-width:min(92vw,420px)}
  dialog::backdrop{background:rgba(0,0,0,.6)}

  .legend{opacity:.9;font-size:.9rem;color:#cbd5e1}
</style>
</head>
<body>

<!-- ===== Pre-game Dashboard ===== -->
<section id="dashboard" aria-label="Dashboard">
  <div class="dash-card">
    <h2 class="dash-title">BASE BREAKER</h2>
    <div class="dash-user" id="dashUser">@Player</div>

    <div class="dash-stats">
      <div class="dash-stat">
        <div class="v" id="dashBest">0</div>
        <div class="k">BEST</div>
      </div>
      <div class="dash-stat">
        <div class="v" id="dashGames">0</div>
        <div class="k">GAMES</div>
      </div>
      <div class="dash-stat">
        <div class="v" id="dashLast">0</div>
        <div class="k">LAST</div>
      </div>
    </div>

    <div class="dash-buttons">
      <button class="btn" id="dashStart">Start Game</button>
      <button class="btn" id="dashLeaderboard">Leaderboard</button>
    </div>
  </div>
</section>
<!-- ===== End Dashboard ===== -->

<div class="wrap">
  <section id="intro" aria-labelledby="title" style="display:none;">
    <h1 id="title">üü¶ BASE BREAKER</h1>
    <p class="lead">
      Break the $ bricks! Move with ‚Üê ‚Üí, launch with Space, or tap the ball to launch on mobile.
      You‚Äôll be asked to pay a small Base fee to start.
    </p>
    <div class="row">
      <button class="btn" id="play">Play</button>
    </div>
    <div class="legend" id="status"></div>
  </section>

  <div id="hud">
    <div class="chip" id="score">Score: 0</div>
    <div class="chip" id="best">Best: 0</div>
    <button class="btn" id="pause">Pause</button>
    <button class="btn" id="showBoard">Leaderboard</button>
  </div>

  <section id="stage">
    <div class="frame">
      <canvas id="game" width="960" height="540" tabindex="0" aria-label="Base Breaker"></canvas>
    </div>
  </section>
</div>

<!-- Floating controls -->
<div class="cornerControl left" aria-label="Move left">
  <button class="fab-btn" id="leftBtn"><span>‚óÄ</span></button>
</div>
<div class="cornerControl right" aria-label="Move right">
  <button class="fab-btn" id="rightBtn"><span>‚ñ∂</span></button>
</div>

<dialog id="over">
  <h3>Game Over</h3>
  <p id="final">Score: 0</p>
  <div class="row" style="margin-top:10px;gap:8px">
    <button class="btn" id="again">Play again</button>
  </div>
</dialog>
<dialog id="board">
  <h3>Leaderboard</h3>
  <ol id="boardList" style="text-align:left"></ol>
  <div class="row" style="margin-top:10px"><button class="btn" id="closeBoard">Close</button></div>
</dialog>

<script>
/********************
 * BASE BREAKER (brick-breaker)
 ********************/
let W=window.innerWidth, H=window.innerHeight;
const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
const rand=(a,b)=>a+Math.random()*(b-a);

let cvs,ctx, t=0, dt=0, last=0, raf=0;
let playing=false, paused=false, over=false;

const paddle={x:0,y:0,w:120,h:16,speed:520};
const ball={x:0,y:0,r:10,vx:0,vy:0,speed:400,stuck:true};
let bricks=[]; // {x,y,w,h,alive}
let score=0, best=Number(localStorage.getItem('basebreakerBest')||0);

const keys=new Set();
const input=()=>({left:keys.has('ArrowLeft')||keys.has('KeyA'), right:keys.has('ArrowRight')||keys.has('KeyD'), launch:keys.has('Space')});

function initCanvas(){
  cvs=document.getElementById('game');
  ctx=cvs.getContext('2d');
  resizeCanvas();
  cvs.focus();
  buildLevel();
  reset(true);

  // tap/click to launch on mobile
  cvs.addEventListener('pointerdown', ()=>{
    if(ball.stuck){ keys.add('Space'); setTimeout(()=>keys.delete('Space'), 80); }
  });
}

function reset(justPlace=false){
  score=0; over=false; t=0;
  paddle.w=Math.max(100, Math.min(180, W*0.22));
  paddle.h=16; paddle.y = H-84; paddle.x = (W-paddle.w)/2;

  ball.r=10; ball.stuck=true;
  ball.x=paddle.x+paddle.w/2; ball.y=paddle.y-ball.r-2;
  ball.vx=rand(-1,1); ball.vy=-1;

  if(!justPlace){for(const b of bricks) b.alive=true;}
}

function buildLevel(){
  bricks.length=0;
  const rows=6, cols=8;
  const gutter=10;
  const totalW = Math.min(W*0.92, 640);
  const brickW = Math.floor((totalW - gutter*(cols-1)) / cols);
  const brickH = 28;
  const offX = (W-totalW)/2;
  const offY = 90;
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      bricks.push({
        x: offX + c*(brickW+gutter),
        y: offY + r*(brickH+gutter),
        w: brickW,
        h: brickH,
        alive: true
      });
    }
  }
}

function startLoop(){
  keys.clear();
  playing=true; paused=false;
  document.getElementById('hud').style.display='flex';
  document.getElementById('stage').style.display='block';
  cancelAnimationFrame(raf); last=performance.now(); raf=requestAnimationFrame(update);
}
window.startLoop = startLoop; // exposed for module script

function update(time){
  dt=(time-last)/1000||0; last=time;
  if(!playing||paused){raf=requestAnimationFrame(update); return draw();}

  t+=dt;
  const inp = input();
  if(inp.left)  paddle.x -= paddle.speed*dt;
  if(inp.right) paddle.x += paddle.speed*dt;
  paddle.x = clamp(paddle.x, 8, W-8-paddle.w);

  if(ball.stuck){
    ball.x = paddle.x + paddle.w/2;
    ball.y = paddle.y - ball.r - 2;
    if(inp.launch){
      const angle = rand(-0.6, -2.2); // upward-ish
      const sp = ball.speed;
      ball.vx = Math.cos(angle)*sp;
      ball.vy = Math.sin(angle)*sp;
      ball.stuck=false;
    }
  }else{
    ball.x += ball.vx*dt;
    ball.y += ball.vy*dt;

    // wall bounces
    if(ball.x-ball.r<0){ball.x=ball.r; ball.vx*=-1;}
    if(ball.x+ball.r>W){ball.x=W-ball.r; ball.vx*=-1;}
    if(ball.y-ball.r<0){ball.y=ball.r; ball.vy*=-1;}

    // paddle bounce
    if(ball.y+ball.r>=paddle.y && ball.y<=paddle.y+paddle.h && ball.x>=paddle.x && ball.x<=paddle.x+paddle.w && ball.vy>0){
      const hit = (ball.x - (paddle.x+paddle.w/2)) / (paddle.w/2); // -1..1
      const angle = (Math.PI*0.8) * (0.5 - 0.5*hit); // fan out
      const speed = Math.min(640, Math.hypot(ball.vx,ball.vy)*1.03);
      ball.vx = Math.cos(angle) * speed * (hit>=0?-1:1) * -1;
      ball.vy = -Math.abs(Math.sin(angle) * speed);
      score += 1;
    }

    // brick collisions
    for(const b of bricks){
      if(!b.alive) continue;
      if(ball.x+ball.r<b.x || ball.x-ball.r>b.x+b.w || ball.y+ball.r<b.y || ball.y-ball.r>b.y+b.h) continue;
      const left   = Math.abs((ball.x+ball.r) - b.x);
      const right  = Math.abs((b.x+b.w) - (ball.x-ball.r));
      const top    = Math.abs((ball.y+ball.r) - b.y);
      const bottom = Math.abs((b.y+b.h) - (ball.y-ball.r));
      const minPen = Math.min(left,right,top,bottom);
      if(minPen===left){ ball.x=b.x-ball.r; ball.vx = -Math.abs(ball.vx); }
      else if(minPen===right){ ball.x=b.x+b.w+ball.r; ball.vx = Math.abs(ball.vx); }
      else if(minPen===top){ ball.y=b.y-ball.r; ball.vy = -Math.abs(ball.vy); }
      else { ball.y=b.y+b.h+ball.r; ball.vy = Math.abs(ball.vy); }
      b.alive=false;
      score += 10;
      break;
    }

    // lose condition
    if(ball.y - ball.r > H+40){
      return endGame();
    }

    // win condition
    if(bricks.every(b=>!b.alive)){
      score += 100;
      return endGame(true);
    }
  }

  draw();
  raf=requestAnimationFrame(update);
}

function draw(){
  // background
  ctx.clearRect(0,0,W,H);
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,'#0a1222'); g.addColorStop(1,'#070a12');
  ctx.fillStyle=g; ctx.fillRect(0,0,W,H);

  // bricks
  for(const b of bricks){
    if(!b.alive) continue;
    drawBrick(b.x,b.y,b.w,b.h);
  }

  // paddle (board) ‚Äî visible & glowy
  ctx.save();
  ctx.shadowColor='rgba(148,163,184,.45)';
  ctx.shadowBlur=10; ctx.shadowOffsetY=2;
  ctx.fillStyle='#a5b4fc';
  roundRect(paddle.x,paddle.y,paddle.w,paddle.h,10,true);
  ctx.shadowColor='transparent';
  ctx.strokeStyle='rgba(255,255,255,.18)';
  ctx.lineWidth=2;
  roundRect(paddle.x+2,paddle.y+2,paddle.w-4,paddle.h-4,9,false,true);
  ctx.restore();

  // ball
  const r=ball.r;
  const radg=ctx.createRadialGradient(ball.x-r/3, ball.y-r/3, r*0.2, ball.x, ball.y, r);
  radg.addColorStop(0,'#ffffff'); radg.addColorStop(1,'#d1d5db');
  ctx.fillStyle=radg;
  ctx.beginPath(); ctx.arc(ball.x,ball.y,r,0,Math.PI*2); ctx.fill();

  // UI
  document.getElementById('score').textContent='Score: '+Math.floor(score);
}

function drawBrick(x,y,w,h){
  ctx.save();
  ctx.shadowColor='rgba(99,102,241,.45)'; ctx.shadowBlur=10; ctx.shadowOffsetY=2;
  ctx.fillStyle='#6366f1';
  roundRect(x,y,w,h,8,true);
  ctx.shadowColor='transparent';
  ctx.strokeStyle='rgba(255,255,255,.18)';
  ctx.lineWidth=2; roundRect(x+2,y+2,w-4,h-4,7,false,true);
  ctx.fillStyle='#eaeaff';
  ctx.font = `${Math.floor(h*0.7)}px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial`;
  ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.fillText('$', x+w/2, y+h/2+1);
  ctx.restore();
}

function roundRect(x,y,w,h,r,fill,stroke){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
  if(fill) ctx.fill();
  if(stroke) ctx.stroke();
}

function pauseToggle(){
  paused=!paused;
  document.getElementById('pause').textContent=paused?'Resume':'Pause';
  if(!paused) last=performance.now();
}

function endGame(win=false){
  playing=false; over=true;
  const s=Math.floor(score);
  best=Math.max(best,s);
  localStorage.setItem('basebreakerBest', best);
  document.getElementById('best').textContent='Best: '+best;
  document.getElementById('final').textContent=(win?'You win! ':'Score: ')+s;
  document.getElementById('over').showModal();
}

/* ===== Input & wiring ===== */
addEventListener('keydown',e=>{
  if(['ArrowLeft','ArrowRight','Space','KeyA','KeyD'].includes(e.code)){ keys.add(e.code); e.preventDefault(); }
});
addEventListener('keyup',e=>keys.delete(e.code));

function wireMobile(){
  const bind=(id,code)=>{
    const el=document.getElementById(id); if(!el) return;
    const press=e=>{keys.add(code); e.preventDefault(); e.stopPropagation();}
    const release=e=>{keys.delete(code); e.preventDefault(); e.stopPropagation();}
    el.addEventListener('touchstart',press,{passive:false});
    el.addEventListener('touchend',release);
    el.addEventListener('touchcancel',release);
    el.addEventListener('mousedown',press);
    el.addEventListener('mouseup',release);
    el.addEventListener('mouseleave',release);
  };
  bind('leftBtn','ArrowLeft');
  bind('rightBtn','ArrowRight');
}

function resizeCanvas(){
  const hud=document.getElementById('hud');
  const topH = hud && hud.style.display!=='none' ? hud.getBoundingClientRect().height : 0;
  W = window.innerWidth;
  H = Math.max(300, Math.floor(window.innerHeight - topH));
  const dpr = window.devicePixelRatio || 1;
  cvs.width = Math.max(1, W * dpr);
  cvs.height = Math.max(1, H * dpr);
  cvs.style.width = W + 'px';
  cvs.style.height = H + 'px';
  ctx.setTransform(dpr,0,0,dpr,0,0);
  buildLevel();
  reset(true);
}

/* ===== Boot ===== */
initCanvas(); wireMobile();
addEventListener('resize',resizeCanvas);

document.getElementById('pause').addEventListener('click',pauseToggle);
document.getElementById('showBoard').addEventListener('click',()=>showLeaderboard());
document.getElementById('closeBoard').addEventListener('click',()=>document.getElementById('board').close());

/* ===== Leaderboard (local) ===== */
function getLeaderboard(){return JSON.parse(localStorage.getItem('basebreakerLeaderboard')||'[]');}
function setLeaderboard(lb){localStorage.setItem('basebreakerLeaderboard', JSON.stringify(lb.slice(0,10)));}

function showLeaderboard(){
  const lb=getLeaderboard();
  const list=document.getElementById('boardList');
  list.innerHTML = lb.length ? lb.map((e,i)=>`<li>#${i+1} ${e.name} ‚Äî ${e.score}</li>`).join('') : '<li>No scores yet.</li>';
  document.getElementById('board').showModal();
}
window.showLeaderboard = showLeaderboard;
</script>

<!-- ===== FARCASTER MINIAPP PAYMENT (Base) + Dashboard wiring ===== -->
<script type="module">
  import { sdk } from 'https://esm.sh/@farcaster/miniapp-sdk';
  sdk.actions.ready();

  const RECIPIENT = '0x8C6e7978ee3324196ea7e478830fF9cD4AD7D507'; // TODO: your address
  const AMOUNT_ETH = '0.00001';
  const USE_BASE_SEPOLIA = false;

  const BASE_MAINNET = {
    chainId: '0x2105',
    chainName: 'Base',
    rpcUrls: ['https://mainnet.base.org'],
    nativeCurrency: { name: 'Ether', symbol: 'ETH', decimals: 18 },
    blockExplorerUrls: ['https://basescan.org']
  };
  const BASE_SEPOLIA = {
    chainId: '0x14a34',
    chainName: 'Base Sepolia',
    rpcUrls: ['https://sepolia.base.org'],
    nativeCurrency: { name: 'Sepolia Ether', symbol: 'ETH', decimals: 18 },
    blockExplorerUrls: ['https://sepolia.basescan.org']
  };
  const TARGET = USE_BASE_SEPOLIA ? BASE_SEPOLIA : BASE_MAINNET;

  const statusEl = document.getElementById('status');
  const playBtn = document.getElementById('play');
  const againBtn = document.getElementById('again');

  let CURRENT_HANDLE='@Player';
  let CURRENT_WALLET='';

  try{
    const viewer = await sdk.viewer.getUser();
    if(viewer?.username){
      CURRENT_HANDLE='@'+viewer.username;
      document.getElementById('dashUser').textContent = CURRENT_HANDLE;
    }
  }catch{}

  function refreshDashboard(){
    const best = Number(localStorage.getItem('basebreakerBest')||0);
    const games = Number(localStorage.getItem('basebreakerGames')||0);
    const last = Number(localStorage.getItem('basebreakerLast')||0);
    document.getElementById('dashBest').textContent = best;
    document.getElementById('dashGames').textContent = games;
    document.getElementById('dashLast').textContent = last;
  }
  refreshDashboard();

  function parseEther(x){
    const [w,f='']=String(x).split('.');
    const frac=(f+'0'.repeat(18)).slice(0,18);
    return '0x'+(BigInt(w)*10n**18n+BigInt(frac)).toString(16);
  }

  async function getProvider(){
    try{ const p = await sdk.wallet.getEthereumProvider(); if(p) return p; }catch{}
    return window.ethereum ?? null;
  }

  async function ensureChain(p, chain){
    const current = (await p.request({method:'eth_chainId'}))?.toLowerCase();
    if(current === chain.chainId.toLowerCase()) return;
    try{
      await p.request({ method:'wallet_switchEthereumChain', params:[{ chainId: chain.chainId }] });
    }catch(e){
      if(e?.code === 4902){
        await p.request({ method:'wallet_addEthereumChain', params:[ chain ] });
        await p.request({ method:'wallet_switchEthereumChain', params:[{ chainId: chain.chainId }] });
      }else{
        throw e;
      }
    }
  }

  function explorerBaseOf(chain){ return (chain.blockExplorerUrls && chain.blockExplorerUrls[0]) || ''; }

  async function requiredPayment(){
    statusEl.innerHTML='<b>Connecting wallet‚Ä¶</b>';
    const provider = await getProvider();
    if(!provider){statusEl.innerHTML+=' <span class="err">No wallet detected.</span>'; throw new Error('NO_PROVIDER')}
    const [from] = await provider.request({method:'eth_requestAccounts'});
    CURRENT_WALLET = from;

    await ensureChain(provider, TARGET);

    statusEl.innerHTML += `<div>Sending ${AMOUNT_ETH} ETH to ${RECIPIENT.slice(0,6)}‚Ä¶${RECIPIENT.slice(-4)}</div>`;
    const hash = await provider.request({
      method:'eth_sendTransaction',
      params:[{ from, to:RECIPIENT, value:parseEther(AMOUNT_ETH) }]
    });
    const ex = explorerBaseOf(TARGET);
    statusEl.innerHTML += `<div class="ok">TX sent! ${ex ? `<a target="_blank" href="${ex}/tx/${hash}">View TX</a>` : ''}</div>`;
    return hash;
  }

  function showGame(){
    document.getElementById('intro').style.display='none';
    document.getElementById('hud').style.display='flex';
    document.getElementById('stage').style.display='block';
    document.getElementById('best').textContent='Best: '+(Number(localStorage.getItem('basebreakerBest')||0));
    window.startLoop?.();
  }

  async function payThenStart(btn){
    try{
      btn.disabled=true;
      await requiredPayment();
      const overDlg = document.getElementById('over');
      if (overDlg && overDlg.open) overDlg.close();
      showGame();
    }catch(e){
      statusEl.innerHTML += '<div class="err">Payment cancelled or failed.</div>';
    }finally{
      btn.disabled=false;
    }
  }

  playBtn.addEventListener('click',e=>{e.preventDefault(); payThenStart(playBtn)});
  againBtn.addEventListener('click',e=>{e.preventDefault(); payThenStart(againBtn)});

  // ===== Dashboard wiring =====
  document.getElementById('dashStart').addEventListener('click', ()=>{
    document.getElementById('intro').style.display='flex';
    document.getElementById('dashboard').style.display='none';
    document.getElementById('play').click();
  });

  document.getElementById('dashLeaderboard').addEventListener('click', ()=>{
    if (typeof window.showLeaderboard === 'function') window.showLeaderboard();
    else document.getElementById('board').showModal();
  });

  function addScoreToLeaderboard(score){
    const shortWallet = CURRENT_WALLET ? `${CURRENT_WALLET.slice(0,6)}‚Ä¶${CURRENT_WALLET.slice(-4)}` : '‚Äî';
    const entryName = `${CURRENT_HANDLE} ¬∑ ${shortWallet}`;
    const lb = JSON.parse(localStorage.getItem('basebreakerLeaderboard') || '[]');
    lb.push({ name: entryName, score: Number(score), ts: Date.now() });
    lb.sort((a,b)=> b.score-a.score || a.ts-b.ts);
    localStorage.setItem('basebreakerLeaderboard', JSON.stringify(lb.slice(0,10)));
  }

  // When Game Over dialog opens, persist stats
  const overDlg = document.getElementById('over');
  const dlgObserver = new MutationObserver(()=> {
    if (overDlg.open) {
      const txt = document.getElementById('final')?.textContent || 'Score: 0';
      const lastScore = Number(txt.replace(/\D+/g,'') || 0);

      const prevBest = Number(localStorage.getItem('basebreakerBest')||0);
      const best = Math.max(prevBest, lastScore);
      const games = (Number(localStorage.getItem('basebreakerGames'))||0) + 1;
      localStorage.setItem('basebreakerBest', best);
      localStorage.setItem('basebreakerGames', games);
      localStorage.setItem('basebreakerLast', lastScore);

      addScoreToLeaderboard(lastScore);
    }
  });
  dlgObserver.observe(overDlg, { attributes:true, attributeFilter:['open'] });

  // Keep dashboard visible on first load
  document.getElementById('dashboard').style.display='flex';
</script>
</body>
</html>
